(()=>{"use strict";var e={9581:(e,t,r)=>{var n=r(5043),o=r(4391),i=r(5475),a=r(1527),s=r(3248),l=r(3930),d=r(4416),c=r(5376),u=r(8390),h=r(3392),m=r(8142),g=r(4194),x=r(579);const p=()=>(0,x.jsx)(m.A,{sx:{height:"100dvh"},alignItems:"center",justifyContent:"center",container:!0,children:(0,x.jsx)(g.A,{severity:"error",children:"Some Failed."})});var v=r(3216),f=r(4117);const j=e=>{const{t:t,i18n:r}=(0,f.Bd)();return(0,n.useEffect)((()=>{document.title=`${t(e)} | HoBu`}),[e,t]),{t:t,i18n:r}};var A=r(3747);class y{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.dbName=void 0,this.dbVersion=void 0,this.db=null,this.dbName=e,this.dbVersion=t}init(){return new Promise(((e,t)=>{const r=indexedDB.open(this.dbName,this.dbVersion);r.onsuccess=()=>{this.db=r.result,e()},r.onerror=()=>{t(r.error)},r.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("categories")){t.createObjectStore("categories",{keyPath:"id",autoIncrement:!0}).createIndex("name","name",{unique:!1})}if(!t.objectStoreNames.contains("orders")){t.createObjectStore("orders",{keyPath:"id",autoIncrement:!0}).createIndex("created_at","created_at",{unique:!1})}}}))}addCategory(e){return this.transaction("categories","readwrite",(t=>new Promise(((r,n)=>{const o=t.add(e);o.onsuccess=()=>{r(o.result)},o.onerror=()=>{n(o.error)}}))))}getCategories(){return this.transaction("categories","readonly",(e=>new Promise(((t,r)=>{const n=e.getAll();n.onsuccess=()=>{t(n.result)},n.onerror=()=>{r(n.error)}}))))}updateCategory(e){return this.transaction("categories","readwrite",(t=>new Promise(((r,n)=>{const o=t.put(e);o.onsuccess=()=>{r(e.id)},o.onerror=()=>{n(o.error)}}))))}deleteCategory(e){return this.transaction("categories","readwrite",(t=>new Promise(((r,n)=>{const o=t.delete(e);o.onsuccess=()=>{r()},o.onerror=()=>{n(o.error)}}))))}addOrder(e){return this.transaction("orders","readwrite",(t=>new Promise(((r,n)=>{const o=t.add(e);o.onsuccess=()=>{r(o.result)},o.onerror=()=>{n(o.error)}}))))}getOrders(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"desc";return this.transaction("orders","readonly",(r=>new Promise(((n,o)=>{const i=r.index("created_at"),a=[];let s;if(null!==e&&void 0!==e&&e.createdAt){const t=e.createdAt.from?new Date(e.createdAt.from).getTime():void 0,r=e.createdAt.to?new Date(e.createdAt.to).getTime():void 0;void 0!==t&&void 0!==r?s=IDBKeyRange.bound(t,r):void 0!==t?s=IDBKeyRange.lowerBound(t):void 0!==r&&(s=IDBKeyRange.upperBound(r))}const l="asc"===t?"next":"prev",d=s?i.openCursor(s,l):i.openCursor(null,l);d.onsuccess=()=>{const t=d.result;if(t){const r=t.value;if(null!==e&&void 0!==e&&e.categories&&e.categories.length>0){if(!e.categories.some((e=>r.category_id===e)))return void t.continue()}a.push(r),t.continue()}else n(a)},d.onerror=()=>{o(d.error)}}))))}updateOrder(e){return this.transaction("orders","readwrite",(t=>new Promise(((r,n)=>{const o=t.put(e);o.onsuccess=()=>{r(e.id)},o.onerror=()=>{n(o.error)}}))))}deleteOrder(e){return this.transaction("orders","readwrite",(t=>new Promise(((r,n)=>{const o=t.delete(e);o.onsuccess=()=>{r()},o.onerror=()=>{n(o.error)}}))))}transaction(e,t,r){return new Promise(((n,o)=>{if(this.db){const i=this.db.transaction(e,t),a=i.objectStore(e);i.onerror=()=>o(i.error),r(a).then(n).catch(o)}else o("Database not initialized")}))}}let b=null;const w=()=>b,E=()=>{const e=w();return(0,A.I)({queryKey:["categories"],queryFn:()=>e.getCategories(),initialData:[]})},S=()=>(()=>{const[e,t]=(0,n.useState)(!1);return(0,n.useLayoutEffect)((()=>{b||async function(){const e=new y("hobu");await e.init(),t(!0),b=e}()}),[]),e})()?(0,x.jsx)(v.sv,{}):null;var _=r(4858),C=r(8911),R=r(5865),O=r(7784),T=r(7353),D=r(1906),k=r(8403),I=r(9058),P=r(7097),M=r(899);const F=(0,M.Ik)().shape({id:(0,M.ai)(),name:(0,M.Yj)().required(),color:(0,M.Yj)().required()}),$=e=>{let{category:t}=e;const r=(0,v.Zp)(),{state:n}=(0,v.zy)(),{control:o,handleSubmit:i,reset:a}=(0,_.mN)({defaultValues:{id:null===t||void 0===t?void 0:t.id,name:(null===t||void 0===t?void 0:t.name)||"",color:(null===t||void 0===t?void 0:t.color)||""},resolver:(0,k.t)(F)}),s=w(),{mutate:l,isPending:d}=(0,P.n)({mutationFn:e=>e.id?s.updateCategory(e):s.addCategory(e)});return(0,x.jsxs)(C.A,{spacing:2,children:[(0,x.jsx)(R.A,{variant:"caption",children:"\u0414\u043e\u0434\u0430\u0442\u0438 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044e"}),(0,x.jsx)(_.xI,{control:o,name:"name",render:e=>{let{field:t,fieldState:{error:r}}=e;return(0,x.jsx)(O.A,{autoComplete:"off",error:!!r,...t,label:"\u0406\u043c\u02bc\u044f"})}}),(0,x.jsx)(_.xI,{control:o,name:"color",render:e=>{let{field:t,fieldState:{error:r}}=e;return(0,x.jsx)(I.TY,{label:"\u041a\u043e\u043b\u0456\u0440",format:"hex",error:!!r,...t})}}),(0,x.jsx)(T.A,{children:(0,x.jsx)(D.A,{sx:e=>{let{spacing:t}=e;return{marginTop:t(6)}},variant:"contained",fullWidth:!0,color:"success",type:"button",onClick:i((e=>l(e,{onSuccess:()=>{a({id:void 0,name:"",color:""});const e=new URLSearchParams({created_at:n.created_at});r({pathname:Oe.REPORT_CREATE,search:e.toString()})}}))),disabled:d,children:"\u0414\u043e\u0434\u0430\u0442\u0438"})})]})};var z=r(8232),B=r(7392),N=r(3193),L=r(9190),Y=r(9599),q=r(8988),G=r(9859),K=r(1787),W=r(8884),V=r(9435),U=r(9389),H=r(7131),Z=r(3444),J=r(7257),Q=r(2316);const X=["credit","debit"];function ee(e){return e.toLocaleString("uk-UA",{style:"currency",currency:"UAH",minimumFractionDigits:2,maximumFractionDigits:2})}const te=()=>{const e=new Date;return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},re=(e,t)=>e*Math.min(...t)/100,ne=(0,M.Ik)().shape({id:(0,M.ai)(),category_id:(0,M.Yj)().required(),created_at:(0,M.Yj)().required(),type:(0,M.Yj)().oneOf(X).required(),note:(0,M.Yj)(),amounts:(0,M.YO)().of((0,M.Ik)().shape({value:(0,M.ai)().required(),category_id:(0,M.ai)()}))}),oe=e=>{let{order:t}=e;const{t:r}=(0,f.Bd)(),o=(0,v.Zp)(),{state:a}=(0,v.zy)(),s=w(),{data:l}=E(),[d,c]=(0,i.ok)(),{control:u,handleSubmit:h,reset:m,watch:g}=(0,_.mN)({defaultValues:{id:null===t||void 0===t?void 0:t.id,category_id:null!==t&&void 0!==t&&t.category_id?String(t.category_id):"",note:(null===t||void 0===t?void 0:t.note)||"",created_at:null!==t&&void 0!==t&&t.created_at?new Date(null===t||void 0===t?void 0:t.created_at).toISOString():d.get("created_at")?d.get("created_at"):te().toISOString(),type:(null===t||void 0===t?void 0:t.type)||"credit",amounts:[{value:(null===t||void 0===t?void 0:t.amount)||""}]},resolver:(0,k.t)(ne)}),{refetch:p,setDate:j}=(0,v.KC)(),{fields:A,append:y,remove:b}=(0,_.jz)({control:u,name:"amounts"}),{mutate:S}=(0,P.n)({mutationFn:e=>{let{id:t,...r}=e;return t?s.updateOrder({...r,id:t}):s.addOrder(r)}}),I=g("created_at");(0,n.useEffect)((()=>{(0,J.f)((0,Q.a)(I))&&(c({created_at:I},{replace:!0}),j(I))}),[I,j,c]),(0,n.useEffect)((()=>{if(a&&a.order){const{created_at:e,amount:t,category_id:r,...n}=a.order;m({...n,created_at:new Date(e).toISOString(),amounts:[{value:t||""}],category_id:`${r}`})}}),[m,a]);const M=()=>o({pathname:Oe.REPORT_CREATE_CATEGORY},{state:{created_at:I}});return(0,x.jsxs)(C.A,{spacing:2,children:[(0,x.jsx)(_.xI,{control:u,name:"created_at",render:e=>{let{field:{value:t,onChange:r,onBlur:n},fieldState:{error:o}}=e;return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(C.A,{direction:"row",alignItems:"center",spacing:2,children:[(0,x.jsx)(R.A,{sx:{flexGrow:1},variant:"caption",children:"\u0414\u043e\u0434\u0430\u0442\u0438 \u0435\u043b\u0435\u043c\u0435\u043d\u0442"}),(0,x.jsx)(B.A,{color:"default","aria-label":"prev day",size:"small",onClick:()=>{const e=new Date(t);e.setDate(e.getDate()-1),r(e.toISOString())},children:(0,x.jsx)(H.A,{fontSize:"inherit"})}),(0,x.jsx)(B.A,{color:"default","aria-label":"next day",size:"small",onClick:()=>{const e=new Date(t);e.setDate(e.getDate()+1),r(e.toISOString())},children:(0,x.jsx)(U.A,{fontSize:"inherit"})})]}),(0,x.jsx)(N.A,{error:!!o,children:(0,x.jsx)(z.l,{label:"\u0414\u0430\u0442\u0430:",format:"dd/MM/yyyy",value:new Date(t),onClose:n,onChange:r})})]})}}),(0,x.jsx)(_.xI,{control:u,name:"type",render:e=>{let{field:t,fieldState:{error:n}}=e;return(0,x.jsxs)(N.A,{fullWidth:!0,error:!!n,children:[(0,x.jsx)(L.A,{children:"\u0422\u0438\u043f"}),(0,x.jsx)(Y.A,{label:"\u0422\u0438\u043f",...t,children:X.map((e=>(0,x.jsx)(q.A,{value:e,children:r(`order.type.${e}`)},e)))})]})}}),(0,x.jsx)(_.xI,{control:u,name:"note",render:e=>{let{field:t,fieldState:{error:r}}=e;return(0,x.jsx)(O.A,{error:!!r,maxRows:4,multiline:!0,...t,label:"\u041e\u043f\u0438\u0441"})}}),(0,x.jsx)(_.xI,{control:u,name:"category_id",render:e=>{let{field:t,fieldState:{error:r}}=e;return(0,x.jsxs)(N.A,{fullWidth:!0,error:!!r,children:[(0,x.jsx)(L.A,{children:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f"}),(0,x.jsxs)(C.A,{spacing:2,direction:"row",alignItems:"center",children:[(0,x.jsxs)(Y.A,{fullWidth:!0,label:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f",...t,children:[0===l.length&&(0,x.jsx)(q.A,{disabled:!0,value:"",children:(0,x.jsx)("em",{children:"\u041d\u0435\u043c\u0430\u0454 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0438\u0445 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u0439"})}),l.map((e=>{let{id:t,name:r,color:n}=e;return(0,x.jsxs)(q.A,{value:t,children:[(0,x.jsx)(Z.A,{sx:{color:n}}),r]},t)}))]}),(0,x.jsx)(B.A,{color:"info","aria-label":"create category",size:"small",onClick:M,children:(0,x.jsx)(V.A,{fontSize:"inherit"})})]})]})}}),A.map(((e,t)=>(0,x.jsxs)(C.A,{direction:"row",spacing:2,alignItems:"center",children:[(0,x.jsx)(_.xI,{render:e=>{let{field:{onChange:t,...r},fieldState:{error:n}}=e;return(0,x.jsxs)(N.A,{fullWidth:!0,error:!!n,children:[(0,x.jsx)(L.A,{children:"\u0421\u0443\u043c\u043c\u0430"}),(0,x.jsx)(G.A,{startAdornment:(0,x.jsx)(K.A,{position:"start",children:"\u20b4"}),label:"\u0421\u0443\u043c\u043c\u0430",autoComplete:"off",...r,onChange:e=>t(e.target.value.replace(/(?<!^)-/g,"").replace(/(?<=\..*)\./g,"").replace(/[^\d-.]/g,""))})]})},name:`amounts.${t}.value`,control:u}),t>0&&(0,x.jsx)(_.xI,{render:e=>{let{field:t,fieldState:{error:r}}=e;return(0,x.jsxs)(N.A,{fullWidth:!0,error:!!r,children:[(0,x.jsx)(L.A,{children:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f"}),(0,x.jsxs)(Y.A,{fullWidth:!0,label:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f",...t,children:[0===l.length&&(0,x.jsx)(q.A,{disabled:!0,value:"",children:(0,x.jsx)("em",{children:"\u041d\u0435\u043c\u0430\u0454 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u0438\u0445 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u0439"})}),l.map((e=>{let{id:t,name:r,color:n}=e;return(0,x.jsxs)(q.A,{value:t,children:[(0,x.jsx)(Z.A,{sx:{color:n}}),r]},t)}))]})]})},name:`amounts.${t}.category_id`,control:u}),0===t?(0,x.jsx)(B.A,{color:"warning","aria-label":"add",size:"small",onClick:()=>y({value:""}),children:(0,x.jsx)(V.A,{fontSize:"inherit"})}):(0,x.jsx)(B.A,{color:"error","aria-label":"delete",size:"small",onClick:()=>b(t),children:(0,x.jsx)(W.A,{fontSize:"inherit"})})]},e.id))),(0,x.jsx)(T.A,{children:(0,x.jsx)(D.A,{sx:e=>{let{spacing:t}=e;return{marginTop:t(6)}},variant:"contained",fullWidth:!0,color:"success",type:"button",onClick:h((e=>{let{amounts:r,note:n,category_id:o,created_at:i,...a}=e;const s=(null===r||void 0===r?void 0:r.reduce(((e,t)=>e+Number(t.value)),0))||0;a.id||(n=r&&r.length>1?`${n} (${r.map((e=>{let{value:t}=e;return t})).join(", ")})`:n);const l=r&&r.length>1&&!a.id;if(S({...a,note:n,category_id:Number(o),amount:s,created_at:new Date(i).getTime()},{onSuccess:()=>{l||(m({id:void 0,note:"",amounts:[{value:(null===t||void 0===t?void 0:t.amount)||""}],created_at:I}),p())}}),l){const e=r.slice(1).filter((e=>!!e.category_id&&!!e.value));e.forEach(((r,n)=>{let{category_id:o,value:s}=r;S({type:a.type,note:"",category_id:Number(o),amount:-1*Number(s),created_at:new Date(i).getTime()},{onSuccess:()=>{n===e.length-1&&(m({note:"",amounts:[{value:(null===t||void 0===t?void 0:t.amount)||""}],created_at:I}),p())}})}))}})),children:"\u0414\u043e\u0434\u0430\u0442\u0438"})})]})},ie=()=>(0,x.jsx)(m.A,{sx:{height:"100dvh"},alignItems:"center",justifyContent:"center",container:!0,children:(0,x.jsx)(g.A,{severity:"error",children:"Sorry, the page you visited does not exist."})});var ae=r(1596),se=r(4010),le=r(4535),de=r(141),ce=r(9432),ue=r(4662),he=r(2255),me=r(3768),ge=r(5054);const xe=(0,M.Ik)().shape({createdAt:(0,M.Ik)().shape({from:(0,M.Yj)(),to:(0,M.Yj)()}),categories:(0,M.YO)().of((0,M.ai)().required())}),pe=(0,n.memo)((function(e){let{onSubmit:t,defaultParams:r}=e;const{t:o}=(0,f.Bd)(),{data:i}=E(),{control:a,handleSubmit:s,watch:l}=(0,_.mN)({defaultValues:{createdAt:{from:(null===r||void 0===r?void 0:r.createdAtFrom)||"",to:(null===r||void 0===r?void 0:r.createdAtTo)||""},categories:(null===r||void 0===r?void 0:r.categories)||[]},resolver:(0,k.t)(xe)}),d=l();return(0,n.useEffect)((()=>{s(t)()}),[d,s,t]),(0,x.jsxs)(C.A,{spacing:2,direction:"row",justifyContent:"space-between",sx:{my:2},children:[(0,x.jsx)(_.xI,{control:a,name:"createdAt.from",render:e=>{let{field:{value:t,onChange:r,onBlur:n},fieldState:{error:i}}=e;return(0,x.jsx)(N.A,{fullWidth:!0,error:!!i,children:(0,x.jsx)(z.l,{label:o("filters.createdAtFrom"),format:"dd/MM/yyyy",value:t?new Date(t):null,onClose:n,onChange:r})})}}),(0,x.jsx)(_.xI,{control:a,name:"createdAt.to",render:e=>{let{field:{value:t,onChange:r,onBlur:n},fieldState:{error:i}}=e;return(0,x.jsx)(N.A,{fullWidth:!0,error:!!i,children:(0,x.jsx)(z.l,{label:o("filters.createdAtTo"),format:"dd/MM/yyyy",value:t?new Date(t):null,onClose:n,onChange:r})})}}),(0,x.jsx)(_.xI,{control:a,name:"categories",render:e=>{let{field:t,fieldState:{error:r}}=e;return(0,x.jsxs)(N.A,{fullWidth:!0,error:!!r,children:[(0,x.jsx)(L.A,{children:o("filters.categories")}),(0,x.jsx)(Y.A,{multiple:!0,...t,renderValue:e=>e.map((e=>{var t;return null===(t=i.find((t=>t.id===e)))||void 0===t?void 0:t.name})).join(", "),children:i.map((e=>{let{id:t,name:r}=e;return(0,x.jsx)(q.A,{value:t,children:r},t)}))})]})}})]})}),(()=>!0)),ve=e=>{const t=w();return(0,A.I)({queryKey:["orders",e],queryFn:()=>t.getOrders(e),initialData:[]})};var fe=r(5953),je=r(6328),Ae=r(36),ye=r(922),be=r(3560),we=r(2780);const Ee=e=>{let{order:t,onSuccessDelete:r,canActions:o=!1}=e;const i=(0,v.Zp)(),[a,s]=(0,n.useState)(!1),l=(0,n.useRef)(null),{data:d}=E(),c=(0,n.useMemo)((()=>d.find((e=>t.category_id===e.id))),[d,t.category_id]),u=w(),h=e=>{l.current&&l.current.contains(e.target)||s(!1)};function m(e){"Tab"===e.key?(e.preventDefault(),s(!1)):"Escape"===e.key&&s(!1)}const g=(0,n.useRef)(a);(0,n.useEffect)((()=>{!0===g.current&&!1===a&&l.current.focus(),g.current=a}),[a]);const{mutate:p}=(0,P.n)({mutationFn:e=>u.deleteOrder(e)}),f=e=>{i(Oe.REPORT_CREATE,{state:{order:t}}),h(e)},j=e=>{confirm(`\u0412\u0438 \u0434\u0456\u0439\u0441\u043d\u043e \u0445\u043e\u0447\u0435\u0442\u0435 \u0432\u0438\u0434\u0430\u043b\u0438\u0442\u0438 \u20b4 ${t.amount} (${(null===c||void 0===c?void 0:c.name)||"DELETED"})`)&&p(t.id,{onSuccess:()=>{i(Oe.REPORT_CREATE),r&&r()}}),h(e)};return(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(ae.A,{sx:e=>{let{spacing:t}=e;return{paddingBlock:t(.5),paddingInline:t(2)}},elevation:a?24:1,ref:l,onClick:()=>{s((e=>!e))},children:(0,x.jsxs)(C.A,{spacing:3,direction:"row",justifyContent:"space-between",children:[(0,x.jsx)(R.A,{sx:{flexBasis:"80px"},variant:"body2",color:"textPrimary",children:ee(t.amount)}),(0,x.jsx)(R.A,{variant:"body2",color:(null===c||void 0===c?void 0:c.color)||"textSecondary",children:(null===c||void 0===c?void 0:c.name)||"DELETED"}),(0,x.jsx)(R.A,{sx:{flexBasis:"40%",flexGrow:1},variant:"caption",children:t.note}),"credit"===t.type&&(0,x.jsx)(ge.A,{color:"error"}),"debit"===t.type&&(0,x.jsx)(me.A,{color:"success"})]})},t.id),(0,x.jsx)(fe.A,{open:a,anchorEl:l.current,role:void 0,placement:"bottom-end",transition:!0,disablePortal:!0,children:e=>{let{TransitionProps:t}=e;return(0,x.jsx)(je.A,{...t,children:(0,x.jsx)(ae.A,{children:(0,x.jsx)(Ae.x,{onClickAway:h,children:(0,x.jsx)(ye.A,{autoFocusItem:a,onKeyDown:m,children:o&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsxs)(q.A,{onClick:f,disableRipple:!0,children:[(0,x.jsx)(be.A,{}),"Edit"]}),(0,x.jsxs)(q.A,{onClick:j,disableRipple:!0,children:[(0,x.jsx)(we.A,{}),"Archive"]})]})})})})})}})]})},Se=()=>{j("Report view");const e=(0,v.Zp)(),[t,r]=(0,i.ok)(),o=(0,n.useMemo)((()=>{const e={},r=t.get("createdAtFrom"),n=t.get("createdAtTo"),o=t.getAll("categories").map(Number);return(r||n)&&(e.createdAt={from:r||void 0,to:n||void 0}),o.length>0&&(e.categories=o),e}),[t]),{data:a}=ve(o),{data:s}=E(),l=(0,n.useRef)(null),[d,c]=(0,n.useState)([0,0]),[u,h]=d,g=(0,n.useMemo)((()=>{const e={average:{},debit:0,credit:0,total:0};return a.forEach((t=>{const r=s.find((e=>e.id===t.category_id));r&&("debit"===t.type?(e.debit+=t.amount,e.total+=t.amount):(e.credit+=t.amount,e.total-=t.amount),e.average[r.id]||(e.average[r.id]={category:r,value:0}),"debit"===t.type?e.average[r.id].value+=t.amount:e.average[r.id].value-=t.amount)})),e}),[s,a]),{credits:p,debits:f}=(0,n.useMemo)((()=>{const e=new Map([]);a.forEach((t=>{let{category_id:r,amount:n,type:o}=t;if("credit"===o){const t=e.get(r);if(t)e.set(r,{...t,value:n+t.value});else{const t=s.find((e=>{let{id:t}=e;return t===r}));e.set(r,{id:`${r}-${o}`,value:n,label:`${(null===t||void 0===t?void 0:t.name)||"DELETED"} (\u0432\u0438\u0442.)`,color:null===t||void 0===t?void 0:t.color})}}}));const t=new Map([]);return a.forEach((e=>{let{category_id:r,amount:n,type:o}=e;if("debit"===o){const e=t.get(r);if(e)t.set(r,{...e,value:n+e.value});else{const e=s.find((e=>{let{id:t}=e;return t===r}));t.set(r,{id:`${r}-${o}`,value:n,label:`${(null===e||void 0===e?void 0:e.name)||"DELETED"} (\u0434\u043e\u0445.)`,color:null===e||void 0===e?void 0:e.color})}}})),{credits:Array.from(e.values()),debits:Array.from(t.values())}}),[s,a]),A=(0,n.useMemo)((()=>{const e=new Map;a.forEach((t=>{let{category_id:r,created_at:n,amount:o,type:i}=t;const a=(0,ce.GP)(new Date(n),"yyyy-MM"),l=e.get(a)||new Map([]),d=(null===l||void 0===l?void 0:l.get(r))||(()=>{const e=s.find((e=>{let{id:t}=e;return t===r}));return{value:0,category:(null===e||void 0===e?void 0:e.name)||"DELETED"}})();d.value="credit"===i?d.value+o:d.value-o,l.set(r,d),e.set(a,l)}));const t=[];return e.forEach(((e,r)=>{const n={month:r};e.forEach((e=>{n[e.category]=e.value})),t.push(n)})),t.sort(((e,t)=>e.month.replace("-","")-t.month.replace("-","")))}),[s,a]);return(0,n.useLayoutEffect)((()=>{setTimeout((()=>{l.current&&c([l.current.getBoundingClientRect().width,600])}),100)}),[]),(0,x.jsxs)(T.A,{sx:{display:"grid",gridTemplateAreas:"\n          'filter filter filter'\n          'orders statistics statistics'\n        ",gridTemplateColumns:"1fr 1fr 1fr",gap:2,height:"100dvh",overflow:"hidden"},children:[(0,x.jsx)(m.A,{sx:{gridArea:"filter"},children:(0,x.jsx)(pe,{onSubmit:e=>{var t,n;const o={};null!==(t=e.createdAt)&&void 0!==t&&t.from&&(o.createdAtFrom=e.createdAt.from),null!==(n=e.createdAt)&&void 0!==n&&n.to&&(o.createdAtTo=e.createdAt.to),e.categories&&(o.categories=e.categories.map(String)),r(o)}})}),(0,x.jsx)(_e,{sx:{gridArea:"orders",p:1},container:!0,direction:"column",wrap:"nowrap",children:a.map(((e,t)=>{const r=0===t||a[t-1].created_at!==e.created_at;return(0,x.jsxs)("div",{children:[r&&(0,x.jsx)(R.A,{color:"textSecondary",fontStyle:"italic",fontWeight:"bold",variant:"subtitle1",sx:{mt:2,mb:1,ml:2},children:(0,ce.GP)(new Date(e.created_at),"dd.MM.yyyy")}),(0,x.jsx)(Ee,{order:e})]},e.id)}))}),(0,x.jsxs)(_e,{sx:{p:1,gridArea:"statistics"},size:8,container:!0,wrap:"nowrap",direction:"column",children:[(0,x.jsx)(R.A,{variant:"h6",children:"\u0417\u0430\u0433\u0430\u043b\u044c\u043d\u0430 \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430"}),(0,x.jsxs)(m.A,{size:12,gap:2,container:!0,children:[(0,x.jsx)(ae.A,{sx:{p:2,flexGrow:1},children:(0,x.jsxs)(C.A,{alignItems:"center",spacing:.5,direction:"row",children:[(0,x.jsx)(me.A,{color:"success"}),(0,x.jsxs)(R.A,{color:"success",variant:"body1",children:["\u0414\u043e\u0445\u043e\u0434\u0438: ",(0,x.jsx)("b",{children:ee(g.debit)})]})]})}),(0,x.jsx)(ae.A,{sx:{p:2,flexGrow:1},children:(0,x.jsxs)(C.A,{alignItems:"center",spacing:.5,direction:"row",children:[(0,x.jsx)(ge.A,{color:"error"}),(0,x.jsxs)(R.A,{color:"error",variant:"body1",children:["\u0412\u0438\u0442\u0440\u0430\u0442\u0438: ",(0,x.jsx)("b",{children:ee(g.credit)})]})]})}),(0,x.jsx)(ae.A,{sx:{p:2,flexGrow:1},children:(0,x.jsxs)(R.A,{color:"warning",variant:"body1",children:["\u0417\u0430\u0433\u0430\u043b\u044c\u043d\u0430 \u0441\u0443\u043c\u0430: ",(0,x.jsx)("b",{children:ee(g.total)})]})})]}),(0,x.jsx)(R.A,{variant:"h6",children:"\u041f\u043e \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u044f\u043c"}),(0,x.jsx)(m.A,{size:12,gap:2,children:(0,x.jsx)(T.A,{sx:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gridTemplateRows:"min-content",gap:2},children:Object.values(g.average).sort(((e,t)=>Math.abs(t.value)-Math.abs(e.value))).map((e=>{let{category:t,value:r}=e;return(0,x.jsx)(ae.A,{sx:{p:2},children:(0,x.jsxs)(R.A,{variant:"body1",component:"div",children:[(0,x.jsxs)(C.A,{alignItems:"center",spacing:.5,direction:"row",children:[r>0?(0,x.jsx)(me.A,{color:"success"}):(0,x.jsx)(ge.A,{color:"error"}),t.name,":"]}),(0,x.jsx)("br",{}),(0,x.jsx)("b",{children:ee(r)})]})},t.id)}))})}),(0,x.jsx)(m.A,{flexGrow:1,size:12,ref:l,children:!!u&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(ue.r,{series:[{data:p,innerRadius:re(30,d),outerRadius:re(15,d),paddingAngle:5,cornerRadius:10,startAngle:-45,cx:re(45,d),cy:re(50,d),valueFormatter:e=>{let{value:t}=e;return ee(t)}},{data:f,innerRadius:re(8,d),outerRadius:re(10,d),paddingAngle:5,cornerRadius:5,startAngle:-45,cx:re(45,d),cy:re(50,d),valueFormatter:e=>{let{value:t}=e;return ee(t)}}],width:u,height:h,slotProps:{legend:{hidden:u<500}}}),(0,x.jsx)(he.E,{dataset:A,series:s.map((e=>{let{name:t,color:r}=e;return{dataKey:t,label:t,color:r,valueFormatter:e=>e?ee(e):null}})),xAxis:[{scaleType:"band",dataKey:"month"}],width:u,height:h,slotProps:{legend:{hidden:u<500}}})]})})]}),(0,x.jsx)(T.A,{sx:e=>{let{spacing:t}=e;return{position:"fixed",bottom:t(3),left:t(3)}},children:(0,x.jsx)(se.A,{size:"large",color:"primary","aria-label":"add",onClick:()=>e(Oe.REPORT_CREATE),children:(0,x.jsx)(de.A,{})})})]})},_e=(0,le.Ay)(m.A)((e=>{let{theme:{palette:t,spacing:r}}=e;return`\n  & {\n    overflow-y: auto;\n    padding-block-end: ${r(12)};\n  }\n  &::-webkit-scrollbar {\n    width: 5px !important;\n    height: 5px !important;\n  }\n  &::-webkit-scrollbar-track {\n    box-shadow: inset 0 0 3px ${t.grey[700]} !important;\n    border-radius: 5px !important;\n  }\n  &::-webkit-scrollbar-thumb {\n    background: ${t.grey[800]} !important;\n    border-radius: 10px !important;\n  }\n`}));var Ce=r(9275);const Re=()=>{j("Create report");const e=(0,v.Zp)(),t=(0,n.useRef)(null),[r,o]=(0,n.useState)(null),[i,a]=(0,n.useState)([0,0]),[s,l]=i,d=(0,n.useMemo)((()=>{if(r){const e=new Date(r);e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0);const t=new Date(e);return t.setDate(t.getDate()+1),t.setMilliseconds(t.getMilliseconds()-1),{from:e.toISOString(),to:t.toISOString()}}}),[r]),{data:c}=E(),{data:u,refetch:h}=ve({createdAt:d}),g=(0,n.useMemo)((()=>u.sort(((e,t)=>e.id<t.id?-1:1))),[u]),{credits:p,debits:f}=(0,n.useMemo)((()=>{const e=new Map([]);u.forEach((t=>{let{category_id:r,amount:n,type:o}=t;if("credit"===o){const t=e.get(r);if(t)e.set(r,{...t,value:n+t.value});else{const t=c.find((e=>{let{id:t}=e;return t===r}));e.set(r,{id:`${r}-${o}`,value:n,label:`${(null===t||void 0===t?void 0:t.name)||"DELETED"} (\u0432\u0438\u0442.)`,color:null===t||void 0===t?void 0:t.color})}}}));const t=new Map([]);return u.forEach((e=>{let{category_id:r,amount:n,type:o}=e;if("debit"===o){const e=t.get(r);if(e)t.set(r,{...e,value:n+e.value});else{const e=c.find((e=>{let{id:t}=e;return t===r}));t.set(r,{id:`${r}-${o}`,value:n,label:`${(null===e||void 0===e?void 0:e.name)||"DELETED"} (\u0434\u043e\u0445.)`,color:null===e||void 0===e?void 0:e.color})}}})),{credits:Array.from(e.values()),debits:Array.from(t.values())}}),[c,u]);return(0,n.useLayoutEffect)((()=>{setTimeout((()=>{t.current&&a([t.current.getBoundingClientRect().width,t.current.getBoundingClientRect().height])}),100)}),[]),(0,x.jsxs)(m.A,{container:!0,spacing:2,sx:{minHeight:"100dvh"},children:[(0,x.jsx)(m.A,{size:8,children:(0,x.jsxs)(m.A,{container:!0,spacing:1,children:[(0,x.jsx)(m.A,{size:6,children:(0,x.jsx)(C.A,{spacing:1,sx:e=>{let{spacing:t}=e;return{paddingInline:t(2),paddingBlock:t(3)}},children:g.map((e=>(0,x.jsx)(Ee,{order:e,canActions:!0,onSuccessDelete:h},e.id)))})}),(0,x.jsxs)(m.A,{ref:t,size:6,children:[(0,x.jsxs)(C.A,{sx:e=>{let{spacing:t}=e;return{paddingInline:t(2),paddingBlock:t(3)}},direction:"row",justifyContent:"flex-end",spacing:3,children:[(0,x.jsxs)(R.A,{sx:{flexGrow:1},variant:"subtitle1",children:["\u0417\u0430\u043f\u0438\u0441\u0438 \u0437\u0430 ",(0,x.jsx)("b",{children:!!r&&(0,ce.GP)(r,"dd.MM.yyyy")})]}),(0,x.jsxs)(C.A,{alignItems:"center",spacing:.5,direction:"row",children:[(0,x.jsx)(me.A,{color:"success"}),(0,x.jsxs)(R.A,{color:"success",variant:"subtitle1",children:["\u0414\u043e\u0445\u0456\u0434 ",(0,x.jsx)("b",{children:ee(f.reduce(((e,t)=>e+t.value),0))})]})]}),(0,x.jsxs)(C.A,{alignItems:"center",spacing:.5,direction:"row",children:[(0,x.jsx)(ge.A,{color:"error"}),(0,x.jsxs)(R.A,{color:"error",align:"right",variant:"subtitle1",children:["\u0412\u0438\u0442\u0440\u0430\u0442\u0438 ",(0,x.jsx)("b",{children:ee(p.reduce(((e,t)=>e+t.value),0))})]})]})]}),!!s&&(0,x.jsx)(ue.r,{series:[{data:p,innerRadius:re(30,i),outerRadius:re(15,i),paddingAngle:5,cornerRadius:10,startAngle:-45,cx:re(45,i),cy:re(50,i)},{data:f,innerRadius:re(8,i),outerRadius:re(10,i),paddingAngle:5,cornerRadius:5,startAngle:-45,cx:re(45,i),cy:re(50,i)}],width:s,height:l,slotProps:{legend:{hidden:s<500}}})]})]})}),(0,x.jsx)(m.A,{size:4,sx:e=>{let{palette:t,spacing:r}=e;return{bgcolor:t.grey[900],padding:r(2)}},children:(0,x.jsx)(v.sv,{context:{refetch:h,setDate:o}})}),(0,x.jsx)(T.A,{sx:e=>{let{spacing:t}=e;return{position:"fixed",bottom:t(3),left:t(3)}},children:(0,x.jsx)(se.A,{size:"large",color:"primary","aria-label":"home",onClick:()=>e(Oe.REPORT),children:(0,x.jsx)(Ce.A,{})})})]})};let Oe=function(e){return e.REPORT="/",e.REPORT_CREATE="/create",e.REPORT_CREATE_CATEGORY="/create/category",e}({});const Te=[{path:"/",element:(0,x.jsx)(S,{}),errorElement:(0,x.jsx)(p,{}),children:[{path:Oe.REPORT,element:(0,x.jsx)(Se,{})},{path:Oe.REPORT_CREATE,element:(0,x.jsx)(Re,{}),children:[{path:"",element:(0,x.jsx)(oe,{})},{path:Oe.REPORT_CREATE_CATEGORY,element:(0,x.jsx)($,{})}]},{path:"*",element:(0,x.jsx)(ie,{})}]}],De=(0,i.Ys)(Te,{basename:"/hobu"});var ke=r(4978),Ie=r(1848);const Pe=JSON.parse('{"order":{"type":{"credit":"\u0412\u0438\u0442\u0440\u0430\u0442\u0430","debit":"\u0414\u043e\u0445\u0456\u0434"}},"filters":{"createdAtFrom":"\u0414\u0430\u0442\u0430 \u0432\u0456\u0434","createdAtTo":"\u0414\u0430\u0442\u0430 \u0434\u043e","categories":"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0456\u0457"}}');let Me=function(e){return e.EN="en",e.UK="uk",e}({});ke.Ay.use(f.r9).use(Ie.A).init({resources:{[Me.UK]:{translation:Pe}},fallbackLng:Me.UK,supportedLngs:[Me.UK],keySeparator:".",interpolation:{escapeValue:!0}});const Fe=new a.E,$e=(0,l.A)({palette:{mode:"dark"}});const ze=function(){return(0,x.jsxs)(d.A,{theme:$e,children:[(0,x.jsx)(c.Ay,{}),(0,x.jsx)(s.Ht,{client:Fe,children:(0,x.jsx)(u.$,{dateAdapter:h.h,children:(0,x.jsx)(i.pg,{router:De})})})]})},Be=e=>{e&&e instanceof Function&&r.e(453).then(r.bind(r,6453)).then((t=>{let{getCLS:r,getFID:n,getFCP:o,getLCP:i,getTTFB:a}=t;r(e),n(e),o(e),i(e),a(e)}))};o.createRoot(document.getElementById("root")).render((0,x.jsx)(n.StrictMode,{children:(0,x.jsx)(ze,{})})),Be()}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}r.m=e,(()=>{var e=[];r.O=(t,n,o,i)=>{if(!n){var a=1/0;for(c=0;c<e.length;c++){n=e[c][0],o=e[c][1],i=e[c][2];for(var s=!0,l=0;l<n.length;l++)(!1&i||a>=i)&&Object.keys(r.O).every((e=>r.O[e](n[l])))?n.splice(l--,1):(s=!1,i<a&&(a=i));if(s){e.splice(c--,1);var d=o();void 0!==d&&(t=d)}}return t}i=i||0;for(var c=e.length;c>0&&e[c-1][2]>i;c--)e[c]=e[c-1];e[c]=[n,o,i]}})(),r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"===typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"===typeof n.then)return n}var i=Object.create(null);r.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>a[e]=()=>n[e]));return a.default=()=>n,r.d(i,a),i}})(),r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>"static/js/"+e+".75976c74.chunk.js",r.miniCssF=e=>{},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="hobu:";r.l=(n,o,i,a)=>{if(e[n])e[n].push(o);else{var s,l;if(void 0!==i)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==t+i){s=u;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,r.nc&&s.setAttribute("nonce",r.nc),s.setAttribute("data-webpack",t+i),s.src=n),e[n]=[o];var h=(t,r)=>{s.onerror=s.onload=null,clearTimeout(m);var o=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((e=>e(r))),t)return t(r)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/hobu/",(()=>{var e={792:0};r.f.j=(t,n)=>{var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var i=new Promise(((r,n)=>o=e[t]=[r,n]));n.push(o[2]=i);var a=r.p+r.u(t),s=new Error;r.l(a,(n=>{if(r.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",s.name="ChunkLoadError",s.type=i,s.request=a,o[1](s)}}),"chunk-"+t,t)}},r.O.j=t=>0===e[t];var t=(t,n)=>{var o,i,a=n[0],s=n[1],l=n[2],d=0;if(a.some((t=>0!==e[t]))){for(o in s)r.o(s,o)&&(r.m[o]=s[o]);if(l)var c=l(r)}for(t&&t(n);d<a.length;d++)i=a[d],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(c)},n=self.webpackChunkhobu=self.webpackChunkhobu||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var n=r.O(void 0,[137],(()=>r(9581)));n=r.O(n)})();
//# sourceMappingURL=main.4181831e.js.map